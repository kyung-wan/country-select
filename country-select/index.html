<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>국가 선택 - 주사위 게임</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            text-align: center;
        }

        h1 {
            color: black;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 300;
        }

        .game-wrapper {
            position: relative;
            display: inline-block;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(5, 120px);
            grid-template-rows: repeat(3, 140px);
            gap: 10px;
            margin-bottom: 30px;
        }

        .cell {
            background-color: white;
            border: 2px solid black;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .cell:hover {
            background-color: #f0f0f0;
        }

        .cell:has(.country-name):hover {
            background-color: #f0f0f0;
        }

        .cell:not(:has(.country-name)):hover {
            background-color: transparent;
        }

        .cell.selected {
            background-color: #e0e0e0;
        }

        .country-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: black;
        }

        .flag-placeholder {
            width: 80px;
            height: 60px;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #999;
            background-color: #f9f9f9;
        }

        .flag-image {
    width: 80px;
    height: 60px;
    object-fit: cover;
    border: 1px solid #ccc;
        }

        .pawn {
            position: absolute;
            width: 30px;
            height: 40px;
            z-index: 10;
            transition: all 0.4s ease-in-out;
            pointer-events: none;
        }

        .pawn svg {
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        .dice-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
            perspective: 1200px;
            perspective-origin: 50% 30%;
        }

        .dice-wrapper {
            width: 50px;
            height: 50px;
            position: relative;
            transform-style: preserve-3d;
            cursor: pointer;
            transition: transform 0.2s;
            --land-x: 0px;
            --land-y: 0px;
            --final-rot-x: 0deg;
            --final-rot-y: 0deg;
            --final-rot-z: 270deg;
        }

        .dice-wrapper:hover {
            transform: scale(1.1);
        }

        .dice-wrapper.rolling {
            animation: roll3dDiagonal 1.2s ease-out forwards;
        }

        @keyframes roll3dDiagonal {
            0% {
                transform: 
                    translateX(-150px) translateY(-100px) translateZ(100px)
                    rotateX(0deg) rotateY(0deg) rotateZ(0deg);
            }
            15% {
                transform: 
                    translateX(-100px) translateY(-70px) translateZ(80px)
                    rotateX(calc(var(--final-rot-x) * 0.15)) rotateY(calc(var(--final-rot-y) * 0.15)) rotateZ(45deg);
            }
            30% {
                transform: 
                    translateX(-50px) translateY(-40px) translateZ(60px)
                    rotateX(calc(var(--final-rot-x) * 0.3)) rotateY(calc(var(--final-rot-y) * 0.3)) rotateZ(90deg);
            }
            45% {
                transform: 
                    translateX(0px) translateY(-10px) translateZ(40px)
                    rotateX(calc(var(--final-rot-x) * 0.5)) rotateY(calc(var(--final-rot-y) * 0.5)) rotateZ(135deg);
            }
            60% {
                transform: 
                    translateX(calc(var(--land-x) * 0.5)) translateY(calc(var(--land-y) * 0.5)) translateZ(20px)
                    rotateX(calc(var(--final-rot-x) * 0.7)) rotateY(calc(var(--final-rot-y) * 0.7)) rotateZ(180deg);
            }
            75% {
                transform: 
                    translateX(calc(var(--land-x) * 0.8)) translateY(calc(var(--land-y) * 0.8)) translateZ(10px)
                    rotateX(calc(var(--final-rot-x) * 0.85)) rotateY(calc(var(--final-rot-y) * 0.85)) rotateZ(225deg);
            }
            85% {
                transform: 
                    translateX(var(--land-x)) translateY(var(--land-y)) translateZ(0px)
                    rotateX(var(--final-rot-x)) rotateY(var(--final-rot-y)) rotateZ(var(--final-rot-z));
            }
            92% {
                transform: 
                    translateX(var(--land-x)) translateY(var(--land-y)) translateZ(-5px)
                    rotateX(var(--final-rot-x)) rotateY(var(--final-rot-y)) rotateZ(var(--final-rot-z));
            }
            96% {
                transform: 
                    translateX(var(--land-x)) translateY(var(--land-y)) translateZ(8px)
                    rotateX(var(--final-rot-x)) rotateY(var(--final-rot-y)) rotateZ(var(--final-rot-z));
            }
            100% {
                transform: 
                    translateX(var(--land-x)) translateY(var(--land-y)) translateZ(0px)
                    rotateX(var(--final-rot-x)) rotateY(var(--final-rot-y)) rotateZ(var(--final-rot-z));
            }
        }

        .dice-face {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: white;
            border: 2px solid black;
            border-radius: 6px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 3px;
            padding: 6px;
            backface-visibility: hidden;
        }

        .dice-dot {
            width: 6px;
            height: 6px;
            background-color: black;
            border-radius: 50%;
        }

        .dice-dot.hidden {
            visibility: hidden;
        }

        /* 주사위 각 면의 3D 위치 */
        .dice-face-1 {
            transform: rotateY(0deg) translateZ(25px);
        }

        .dice-face-2 {
            transform: rotateX(-90deg) translateZ(25px);
        }

        .dice-face-3 {
            transform: rotateY(-90deg) translateZ(25px);
        }

        .dice-face-4 {
            transform: rotateY(90deg) translateZ(25px);
        }

        .dice-face-5 {
            transform: rotateX(90deg) translateZ(25px);
        }

        .dice-face-6 {
            transform: rotateY(180deg) translateZ(25px);
        }

        .button {
            background-color: white;
            color: black;
            border: 2px solid black;
            padding: 12px 30px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            margin: 10px;
        }

        .button:hover {
            background-color: black;
            color: white;
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .message {
            margin-top: 20px;
            font-size: 18px;
            color: black;
            min-height: 30px;
        }

        .controls {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>출신 국가를 선택하세요</h1>
        
        <div class="game-wrapper">
            <div class="grid" id="grid">
                <!-- 3x5 그리드 생성 -->
            </div>
            
            <!-- 말 (폰) -->
            <div class="pawn" id="pawn">
                <svg viewBox="0 0 30 40" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="15" cy="8" r="6" fill="white" stroke="black" stroke-width="2"/>
                    <path d="M 10 14 Q 15 20, 20 14 L 18 32 L 12 32 Z" fill="white" stroke="black" stroke-width="2"/>
                    <ellipse cx="15" cy="36" rx="8" ry="3" fill="white" stroke="black" stroke-width="2"/>
                </svg>
            </div>
            
            <!-- 주사위 -->
            <div class="dice-container">
                <div class="dice-wrapper" id="diceWrapper" onclick="rollDice()">
                    <!-- Face 1 -->
                    <div class="dice-face dice-face-1">
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                    </div>
                    <!-- Face 2 -->
                    <div class="dice-face dice-face-2">
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                    </div>
                    <!-- Face 3 -->
                    <div class="dice-face dice-face-3">
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                    </div>
                    <!-- Face 4 -->
                    <div class="dice-face dice-face-4">
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                    </div>
                    <!-- Face 5 -->
                    <div class="dice-face dice-face-5">
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                    </div>
                    <!-- Face 6 -->
                    <div class="dice-face dice-face-6">
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                        <div class="dice-dot"></div>
                        <div class="dice-dot hidden"></div>
                        <div class="dice-dot"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button class="button" onclick="confirmSelection()" id="confirmButton" disabled>국가 선택 완료</button>
        </div>
        
        <div class="message" id="message"></div>
    </div>

    <script>
        // 12개 국가 (한국, 중국, 일본, 미국 포함) - 가운데 3칸은 비움
        const countries = [
            '호주', '시리아', '일본', '미국', '영국',
            '케냐', null, null, null, '독일',
            '중국', '인도', '브라질', '한국', '러시아'
        ];

        let currentPosition = 0;
        let isRolling = false;
        let selectedCountry = '';

        // 주사위 점 패턴 설정
        function setDiceDots(number) {
            // 3D 주사위에서는 회전으로 면을 보여주므로 이 함수는 불필요
            // 대신 주사위 회전 설정 함수 사용
        }

        // 주사위를 특정 면으로 회전
        function rotateDiceToFace(face) {
            const diceWrapper = document.getElementById('diceWrapper');
            const rotations = {
                1: 'rotateX(0deg) rotateY(0deg)',
                2: 'rotateX(0deg) rotateY(-90deg)',
                3: 'rotateX(-90deg) rotateY(0deg)',
                4: 'rotateX(90deg) rotateY(0deg)',
                5: 'rotateX(0deg) rotateY(90deg)',
                6: 'rotateX(0deg) rotateY(180deg)'
            };
            diceWrapper.style.transform = rotations[face];
        }

        // 그리드 생성
        function createGrid() {
            const grid = document.getElementById('grid');
            countries.forEach((country, index) => {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.index = index;
                
                if (country === null) {
                    // 빈 칸은 투명하게
                    cell.style.border = 'none';
                    cell.style.backgroundColor = 'transparent';
                    cell.style.cursor = 'default';
                } else {
                    const countryName = document.createElement('div');
                    countryName.className = 'country-name';
                    countryName.textContent = country;
                    
                    const flag = document.createElement('div');
                    flag.src = `flags/${country}.svg`;  // 파일 이름은 국가명과 동일하게!
                    flag.alt = `${country} 국기`;
                    
                    cell.appendChild(countryName);
                    cell.appendChild(flag);
                }
                
                grid.appendChild(cell);
            });
            
            updatePawnPosition();
        }

        // 이동 경로 정의 (row, col 형식)
        const movementPath = [
            {row: 0, col: 0}, // 1,1
            {row: 0, col: 1}, // 1,2
            {row: 0, col: 2}, // 1,3
            {row: 0, col: 3}, // 1,4
            {row: 0, col: 4}, // 1,5
            {row: 1, col: 4}, // 2,5
            {row: 2, col: 4}, // 3,5
            {row: 2, col: 3}, // 3,4
            {row: 2, col: 2}, // 3,3
            {row: 2, col: 1}, // 3,2
            {row: 2, col: 0}, // 3,1
            {row: 1, col: 0}  // 2,1
        ];

        // 현재 경로상의 위치 인덱스
        let pathIndex = 0;

        // 그리드 인덱스를 행/열로 변환
        function indexToRowCol(index) {
            const row = Math.floor(index / 5);
            const col = index % 5;
            return { row, col };
        }

        // 행/열을 그리드 인덱스로 변환
        function rowColToIndex(row, col) {
            return row * 5 + col;
        }

        // 다음 위치 계산 (정해진 경로를 따라)
        function getNextPosition() {
            // 경로를 따라 다음 위치로 이동
            pathIndex = (pathIndex + 1) % movementPath.length;
            const nextPos = movementPath[pathIndex];
            return rowColToIndex(nextPos.row, nextPos.col);
        }

        // 말의 위치 업데이트
        function updatePawnPosition() {
            const cells = document.querySelectorAll('.cell');
            const targetCell = cells[currentPosition];
            const rect = targetCell.getBoundingClientRect();
            const gridRect = document.getElementById('grid').getBoundingClientRect();
            
            const pawn = document.getElementById('pawn');
            pawn.style.left = (rect.left - gridRect.left + rect.width / 2 - 15) + 'px';
            pawn.style.top = (rect.top - gridRect.top + 10) + 'px';
            
            // 선택된 칸 하이라이트
            cells.forEach(cell => cell.classList.remove('selected'));
            targetCell.classList.add('selected');
            
            selectedCountry = countries[currentPosition];
        }

        // 주사위 굴리기
        function rollDice() {
            if (isRolling) return;
            
            isRolling = true;
            document.getElementById('confirmButton').disabled = true;
            document.getElementById('message').textContent = '';
            
            const diceWrapper = document.getElementById('diceWrapper');
            
            // 최종 주사위 눈 결정
            const finalNumber = Math.floor(Math.random() * 6) + 1;
            
            // 각 면을 앞으로 가져오는 정확한 회전
            // 기본 상태에서 dice-face-1이 앞을 향하고 있음
            // dice-face-1: rotateY(0deg) translateZ(25px) -> 0도에서 앞면
            // dice-face-2: rotateY(90deg) translateZ(25px) -> -90도 회전하면 앞으로
            // dice-face-3: rotateX(90deg) translateZ(25px) -> -90도 X회전하면 앞으로
            // dice-face-4: rotateX(-90deg) translateZ(25px) -> 90도 X회전하면 앞으로
            // dice-face-5: rotateY(-90deg) translateZ(25px) -> 90도 Y회전하면 앞으로
            // dice-face-6: rotateY(180deg) translateZ(25px) -> -180도 또는 180도 Y회전하면 앞으로
            
            const finalRotations = {
                1: { x: 0, y: 0 },        // dice-face-1 (1점): rotateY(0deg) 
                2: { x: 90, y: 0 },       // dice-face-2 (2점): rotateX(-90deg) -> 큐브를 X=90으로
                3: { x: 0, y: 90 },       // dice-face-3 (3점): rotateY(-90deg) -> 큐브를 Y=90으로
                4: { x: 0, y: -90 },      // dice-face-4 (4점): rotateY(90deg) -> 큐브를 Y=-90으로
                5: { x: -90, y: 0 },      // dice-face-5 (5점): rotateX(90deg) -> 큐브를 X=-90으로
                6: { x: 0, y: 180 }       // dice-face-6 (6점): rotateY(180deg)
            };
            
            const targetRot = finalRotations[finalNumber];
            
            // 여러 바퀴 회전 추가 (360도 배수만 사용)
            const extraSpins = 2;
            const finalRotX = targetRot.x + (360 * extraSpins);
            const finalRotY = targetRot.y + (360 * extraSpins);
            
            // Z축 회전은 0으로 고정
            const finalRotZ = 0;
            
            // 랜덤 착지 위치 계산
            const randomX = Math.random() * 200 - 100;
            const randomY = Math.random() * 100 - 50;
            
            // CSS 변수로 최종 회전값과 위치 설정
            diceWrapper.style.setProperty('--final-rot-x', `${finalRotX}deg`);
            diceWrapper.style.setProperty('--final-rot-y', `${finalRotY}deg`);
            diceWrapper.style.setProperty('--final-rot-z', `${finalRotZ}deg`);
            diceWrapper.style.setProperty('--land-x', `${randomX}px`);
            diceWrapper.style.setProperty('--land-y', `${randomY}px`);
            
            // 초기 위치로 리셋 (왼쪽 위로)
            diceWrapper.style.transform = 'translateX(-150px) translateY(-100px) translateZ(100px)';
            
            setTimeout(() => {
                diceWrapper.classList.add('rolling');
                
                // 애니메이션이 끝나면 최종 상태를 직접 설정
                setTimeout(() => {
                    diceWrapper.classList.remove('rolling');
                    // 정확한 최종 회전값 적용 (추가 회전 제거)
                    diceWrapper.style.transform = `translateX(${randomX}px) translateY(${randomY}px) translateZ(0px) rotateX(${targetRot.x}deg) rotateY(${targetRot.y}deg) rotateZ(0deg)`;
                    
                    // 말 이동
                    setTimeout(() => {
                        movePawn(finalNumber);
                    }, 300);
                }, 1200);
            }, 100);
        }

        // 말 이동
        function movePawn(steps) {
            let moved = 0;
            const moveInterval = setInterval(() => {
                if (moved < steps) {
                    // 다음 경로 위치로 이동
                    pathIndex = (pathIndex + 1) % movementPath.length;
                    const nextPos = movementPath[pathIndex];
                    currentPosition = rowColToIndex(nextPos.row, nextPos.col);
                    
                    // 빈 칸이면 카운트하지 않고 계속 이동
                    if (countries[currentPosition] === null) {
                        // moved는 증가시키지 않음
                    } else {
                        // 실제 칸이면 카운트
                        moved++;
                    }
                    
                    updatePawnPosition();
                } else {
                    clearInterval(moveInterval);
                    isRolling = false;
                    document.getElementById('confirmButton').disabled = false;
                    document.getElementById('message').textContent = 
                        `${selectedCountry}에 도착했습니다! 이 국가를 선택하시겠습니까?`;
                }
            }, 400);
        }

        // 국가 선택 완료
        function confirmSelection() {
            alert(`${selectedCountry}(으)로 회원가입을 진행합니다!`);
            // 여기에 실제 회원가입 로직 추가
            // 예: window.location.href = '/signup?country=' + selectedCountry;
        }

        // 초기화
        createGrid();
        // 초기 주사위는 중앙에 표시
        const diceWrapper = document.getElementById('diceWrapper');
        diceWrapper.style.transform = 'translateX(0px) translateY(0px) rotateX(0deg) rotateY(0deg)';
    </script>
</body>
</html>
